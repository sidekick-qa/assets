openapi: "3.0.3"
info:
  description: "This is the api server schema."
  version: "1.0.0"
  title: "Sidekick Api"
  termsOfService: "https://docs.answerbot.app/terms-of-service/"
  contact:
    email: "colethienes@sidekickqa.com"
  license:
    name: "Apache 2.0"
    url: "http://www.apache.org/licenses/LICENSE-2.0.html"
tags:
- name: "questions"
  description: "A saved question for a website."
- name: "queries"
  description: "One query to the answer service."
- name: "websites"
  description: "A domain and account combination."
- name: "accounts"
  description: "An individual user account."
- name: "slack"
  description: "Resources for managing a slack integration."
- name: "analytics"
  description: "Metrics."
paths:
  /questions:
    post:
      tags:
      - "questions"
      summary: "Add a question."
      description: ""
      operationId: "addQuestion"
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Question'
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid question"
      security:
      - accountId: []
  /questions/{questionId}:
    get:
      tags:
        - "questions"
      summary: "Get a question."
      description: ""
      operationId: "getQuestion"
      parameters:
        - in: path
          name: questionId
          schema:
            type: string
          required: true
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Question'
        "404":
          description: "Question not found"
    patch:
      tags:
      - "questions"
      summary: "Update an existing question"
      description: ""
      operationId: "updateQuestion"
      parameters:
        - in: path
          name: questionId
          schema:
            type: string
          required: true
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Question'
      responses:
        "200":
          description: "success"
        "404":
          description: "Question not found"
  /questions/search:
    post:
      tags:
      - "questions"
      summary: "Search through questions."
      description: ""
      operationId: "searchQuestions"
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestBodyQuestionsSearchPost'
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseBodyQuestionsSearchPost'
        "400":
          description: "Invalid status value"
  /queries:
    post:
      tags:
      - "queries"
      summary: "Get an answer for a given query."
      description: ""
      operationId: "queryQuestion"
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestBodyQueriesPost'
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Question'
        "400":
          description: "Invalid status value"
  /queries/history:
    post:
      tags:
      - "queries"
      summary: "Get most recent queries, with given filters."
      description: ""
      operationId: "getQueriesHistory"
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestBodyQueriesHistoryGet'
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseBodyQueriesHistoryPost'
        "400":
          description: "Invalid status value"
  /websites:
    post:
      tags:
      - "websites"
      summary: "Add a website."
      description: ""
      operationId: "addWebsite"
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestBodyWebsitesPost'
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Website'
        "400":
          description: "Invalid status value"
  /websites/{websiteId}:
    patch:
      tags:
        - "websites"
      summary: "Update a website."
      description: ""
      operationId: "updateWebsite"
      parameters:
        - in: path
          name: websiteId
          schema:
            type: string
          required: true
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Website'
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid status value"
    delete:
      tags:
        - "websites"
      summary: "Delete a website."
      description: ""
      operationId: "deleteWebsite"
      parameters:
      - in: path
        name: websiteId
        schema:
          type: string
        required: true
        description: Website Id of the website to delete
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid status value"
  /accounts/search:
    post:
      tags:
        - "accounts"
      summary: "Get all accounts the user has access to."
      description: ""
      operationId: "getAccounts"
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseBodyAccountsSearchPost'
        "400":
          description: "Invalid status value"
  /accounts/login/{firebaseIdToken}:
    post:
      tags:
        - "accounts"
      summary: "Login with a firebase id token."
      description: ""
      operationId: "login"
      parameters:
        - in: path
          name: firebaseIdToken
          schema:
            type: string
          required: true
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        "400":
          description: "Invalid status value"
  /accounts/switch/{accountId}:
    post:
      tags:
        - "accounts"
      summary: "Switch accounts (admin only)."
      description: ""
      operationId: "switchAccount"
      parameters:
        - in: path
          name: accountId
          schema:
            type: string
          required: true
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        "400":
          description: "Invalid status value"
  /slack/teams:
    post:
      tags:
        - "slack"
      summary: "Add slack integration."
      description: ""
      operationId: "addSlackTeam"
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlackTeam'
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid status value"
  /slack/teams/{slackTeamId}:
    get:
      tags:
        - "slack"
      summary: "Get slack integration."
      description: ""
      operationId: "getSlackTeam"
      parameters:
        - in: path
          name: slackTeamId
          schema:
            type: string
          required: true
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackTeam'
        "400":
          description: "Invalid status value"
    patch:
      tags:
        - "slack"
      summary: "Update slack integration."
      description: ""
      operationId: "updateSlackTeam"
      parameters:
        - in: path
          name: slackTeamId
          schema:
            type: string
          required: true
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlackTeam'
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid status value"
  /analytics/charts:
    get:
      tags:
        - "analytics"
      summary: "Get charts for an account."
      description: ""
      operationId: "getCharts"
      responses:
        "200":
          description: "success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Chart'
        "400":
          description: "Invalid status value"
    post:
      tags:
        - "analytics"
      summary: "Add an analytics chart."
      description: ""
      operationId: "addChart"
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Chart'
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid status value"
  /analytics/charts/{chartId}:
    patch:
      tags:
        - "analytics"
      summary: "Update a chart."
      description: ""
      operationId: "updateChart"
      parameters:
        - in: path
          name: chartId
          schema:
            type: string
          required: true
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Chart'
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid status value"
    delete:
      tags:
        - "analytics"
      summary: "Delete a chart."
      description: ""
      operationId: "deleteChart"
      parameters:
        - in: path
          name: chartId
          schema:
            type: string
          required: true
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid status value"
  /analytics/charts/data:
    post:
      tags:
        - "analytics"
      summary: "Get chart data."
      description: ""
      operationId: "getChartData"
      requestBody:
        description: ""
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChartMetrics'
      responses:
        "200":
          description: "success"
        "400":
          description: "Invalid status value"

components:
  securitySchemes:
    accountId:
      type: "apiKey"
      name: "accountId"
      in: "cookie"
  schemas:

    Account:
      type: object
      properties:
        email:
          type: string
        id:
          type: string
        is_admin:
          type: boolean
        name:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        photo_url:
          type: string
          nullable: true
        provider:
          type: string
    Question:
      type: "object"
      properties:
        answer_text:
          type: string
        id:
          type: string
        is_certified:
          type: boolean
        is_featured:
          type: boolean
        link:
          type: string
          nullable: true
        question_text:
          type: string
          nullable: false
        search_links:
          type: array
          items:
            type: string
          nullable: true
        search_snippets:
          type: array
          items:
            type: string
          nullable: true
        search_titles:
          type: array
          items:
            type: string
          nullable: true
        title:
          type: string
          nullable: true
    Query:
      type: object
      properties:
        answer_text:
          type: string
          nullable: true
        id:
          type: string
        link:
          type: string
          nullable: true
        question_text:
          type: string
        source:
          type: string
        timestamp:
          type: integer
        visitor_id:
          type: string
          nullable: true
        was_helpful:
          type: boolean
          nullable: true
    SlackTeam:
      type: object
      properties:
        access_token:
          type: string
        account_id:
          type: string
        bot_access_token:
          type: string
        bot_icon_url:
          type: string
          nullable: true
        bot_id:
          type: string
        bot_name:
          type: string
          nullable: true
        bot_user_id:
          type: string
        enterprise_id:
          type: string
          nullable: true
        id:
          type: string
        sld:
          type: string
        team_id:
          type: string
        team_name:
          type: string
    Website:
      type: object
      properties:
        call_to_action_exists:
          type: boolean
        call_to_action_link:
          type: string
        can_search_web:
          type: boolean
        color:
          type: string
        contact_link:
          type: string
        header_text:
          type: string
        id:
          type: string
        sld:
          type: string
        subdomains:
          nullable: false
          type: array
          items:
            type: string

    Chart:
      type: object
      properties:
        chart_type:
          type: string
          enum: [line, bar, area]
        id:
          type: string
        name:
          type: string
        period:
          type: string
          enum: [hour, day, week, month, all_time]
        website_id:
          type: string
        metrics:
          $ref: '#/components/schemas/ChartMetrics'
    ChartMetrics:
      type: array
      items:
        oneOf:
        - $ref: '#/components/schemas/ChartMetricQuery'
        - $ref: '#/components/schemas/ChartMetricVisit'
        - $ref: '#/components/schemas/ChartMetricOpen'
        - $ref: '#/components/schemas/ChartMetricClose'
        - $ref: '#/components/schemas/ChartMetricClickCTA'
    ChartMetricQuery:
      type: object
      properties:
        filters:
          properties:
            answer_text:
              type: string
            question_text:
              type: string
            source:
              type: string
              enum: [web, slack]
            was_helpful:
              type: boolean
          type: object
        type:
          type: string
          enum: [query]
    ChartMetricVisit:
      type: object
      properties:
        filters:
          properties:
            url:
              type: string
          type: object
        type:
          type: string
          enum: [visit]
    ChartMetricOpen:
      type: object
      properties:
        filters:
          properties:
            url:
              type: string
          type: object
        type:
          type: string
          enum: [open]
    ChartMetricClose:
      type: object
      properties:
        filters:
          properties:
            url:
              type: string
          type: object
        type:
          type: string
          enum: [close]
    ChartMetricClickCTA:
      type: object
      properties:
        filters:
          properties:
            url:
              type: string
          type: object
        type:
          type: string
          enum: [clickCTA]

    RequestBodyQueriesHistoryGet:
      type: "object"
      properties:
        not_answered:
            type: boolean
        pages:
            type: integer
        query:
            type: string
        to_csv:
            type: boolean
        was_helpful:
            type: boolean
        was_not_helpful:
            type: boolean
        website_id:
            type: string
    RequestBodyQueriesPost:
      type: "object"
      properties:
        accountId:
          type: string
        query:
          type: string
        url:
          type: string
        source:
          type: string
        location:
          type: string
        visitorId:
          type: string
        ignoreCache:
          type: boolean
    RequestBodyWebsitesPost:
      type: object
      properties:
        url:
          type: string
    RequestBodyQuestionsSearchPost:
      type: object
      properties:
        is_certified:
          type: boolean
        is_featured:
          type: boolean
        text:
          type: string
    ResponseBodyQuestionsSearchPost:
      type: array
      items:
        $ref: '#/components/schemas/Question'
    ResponseBodyQueriesHistoryPost:
      type: array
      items:
        $ref: '#/components/schemas/Query'
    ResponseBodyAccountsSearchPost:
      type: array
      items:
        $ref: '#/components/schemas/Account'

